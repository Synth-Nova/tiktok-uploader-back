<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynthNova Video Pipeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e4;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #888;
            font-size: 1.1em;
        }
        
        /* Pipeline Steps */
        .pipeline {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            overflow-x: auto;
            padding: 20px 0;
        }
        
        .step {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            background: #1e1e3f;
            border-radius: 10px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .step:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
        }
        
        .step.active {
            border-color: #00d4ff;
            background: #252550;
        }
        
        .step.completed {
            border-color: #00ff88;
        }
        
        .step-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .step-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .step-status {
            font-size: 0.8em;
            color: #888;
        }
        
        .step.completed .step-status {
            color: #00ff88;
        }
        
        /* Arrow between steps */
        .arrow {
            display: flex;
            align-items: center;
            color: #444;
            font-size: 1.5em;
        }
        
        /* Main content area */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        
        .panel {
            background: #1e1e3f;
            border-radius: 15px;
            padding: 25px;
        }
        
        .panel h2 {
            color: #00d4ff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: #16213e;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #0099cc);
            color: #fff;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }
        
        .btn-secondary {
            background: #333;
            color: #fff;
        }
        
        .btn-success {
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            color: #000;
        }
        
        .btn-danger {
            background: #ff4757;
            color: #fff;
        }
        
        /* File list */
        .file-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #16213e;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .file-item:hover {
            background: #1a2747;
        }
        
        .file-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-size {
            color: #888;
            font-size: 0.9em;
            margin-left: 15px;
        }
        
        /* Progress */
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 20px;
            background: #16213e;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #888;
        }
        
        /* Stats sidebar */
        .stats-card {
            background: #16213e;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .stats-card h4 {
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        .stats-value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .stats-label {
            color: #888;
            font-size: 0.8em;
        }
        
        /* Log panel */
        .log-panel {
            background: #0a0a1a;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.85em;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 4px;
        }
        
        .log-entry.info { color: #00d4ff; }
        .log-entry.success { color: #00ff88; }
        .log-entry.error { color: #ff4757; }
        .log-entry.warning { color: #ffa502; }
        
        /* Presets */
        .preset-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .preset-card {
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .preset-card:hover {
            border-color: #00d4ff;
        }
        
        .preset-card.selected {
            border-color: #00ff88;
            background: #1a2747;
        }
        
        .preset-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .preset-desc {
            font-size: 0.8em;
            color: #888;
        }
        
        /* Tab navigation */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #00d4ff;
        }
        
        .tab.active {
            color: #00d4ff;
            border-bottom-color: #00d4ff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Sound library */
        .sound-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #16213e;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        .sound-item:hover {
            background: #1a2747;
        }
        
        .sound-item.selected {
            border: 1px solid #00d4ff;
        }
        
        .sound-icon {
            font-size: 1.5em;
            margin-right: 15px;
        }
        
        .sound-info {
            flex: 1;
        }
        
        .sound-name {
            font-weight: bold;
        }
        
        .sound-duration {
            color: #888;
            font-size: 0.85em;
        }
        
        /* API URL config */
        .api-config {
            background: #16213e;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .api-config input {
            margin-bottom: 10px;
        }
        
        .api-status {
            display: inline-flex;
            align-items: center;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        
        .api-status.connected {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .api-status.disconnected {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: linear-gradient(135deg, #1e1e3f 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid #00d4ff;
            box-shadow: 0 10px 50px rgba(0, 212, 255, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .modal-header h2 {
            color: #00d4ff;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 2em;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #ff4757;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .product-card {
            background: #0a0a1a;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .product-card:hover {
            border-color: #00d4ff;
            transform: translateY(-3px);
        }
        
        .product-card.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .product-country {
            font-size: 1.5em;
            margin-bottom: 8px;
        }
        
        .product-name {
            font-weight: bold;
            font-size: 0.95em;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .product-price {
            color: #00ff88;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .product-stock {
            color: #888;
            font-size: 0.85em;
        }
        
        .country-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .country-btn {
            padding: 8px 15px;
            border-radius: 20px;
            background: #16213e;
            border: 1px solid #333;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .country-btn:hover {
            border-color: #00d4ff;
        }
        
        .country-btn.active {
            background: #00d4ff;
            color: #000;
        }
        
        .quick-buy-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: linear-gradient(90deg, #ff4757, #ff6b81);
            color: #fff;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Responsive */
        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .pipeline {
                flex-wrap: wrap;
            }
            
            .step {
                min-width: calc(33% - 10px);
                margin-bottom: 10px;
            }
            
            .arrow {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav style="display: flex; gap: 15px; margin-bottom: 20px; padding: 15px; background: #0a0a1a; border-radius: 10px;">
            <a href="pipeline.html" style="color: #00d4ff; text-decoration: none; padding: 8px 15px; background: #1e1e3f; border-radius: 8px;">üé¨ Video Pipeline</a>
            <a href="accounts.html" style="color: #888; text-decoration: none; padding: 8px 15px; border-radius: 8px; transition: all 0.3s;">üë• –ê–∫–∫–∞—É–Ω—Ç—ã</a>
            <a href="/dashboard" style="color: #888; text-decoration: none; padding: 8px 15px; border-radius: 8px; transition: all 0.3s;">üìä Dashboard</a>
        </nav>
        
        <header>
            <h1>üé¨ SynthNova Video Pipeline</h1>
            <p class="subtitle">–î–ª–∏–Ω–Ω–æ–µ –≤–∏–¥–µ–æ ‚Üí –ú–Ω–æ–≥–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö ‚Üí TikTok ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
        </header>
        
        <!-- API Configuration -->
        <div class="api-config">
            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 300px;">
                    <input type="text" id="apiUrl" placeholder="API URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: http://localhost:8080)" value="https://8090-iizrsucry9ebg87ccb608-b9b802c4.sandbox.novita.ai">
                </div>
                <button class="btn btn-secondary" onclick="testConnection()">üîå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <span id="apiStatus" class="api-status disconnected">‚óè –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
            </div>
        </div>
        
        <!-- Pipeline Steps -->
        <div class="pipeline">
            <div class="step active" onclick="showStep(1)" id="step1">
                <div class="step-icon">üìπ</div>
                <div class="step-title">1. –ù–∞—Ä–µ–∑–∫–∞</div>
                <div class="step-status">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            <div class="arrow">‚Üí</div>
            <div class="step" onclick="showStep(2)" id="step2">
                <div class="step-icon">‚ú®</div>
                <div class="step-title">2. –£–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è</div>
                <div class="step-status">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            <div class="arrow">‚Üí</div>
            <div class="step" onclick="showStep(3)" id="step3">
                <div class="step-icon">üéµ</div>
                <div class="step-title">3. Sound ID</div>
                <div class="step-status">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            <div class="arrow">‚Üí</div>
            <div class="step" onclick="showStep(4)" id="step4">
                <div class="step-icon">üì¶</div>
                <div class="step-title">4. –£–ø–∞–∫–æ–≤–∫–∞</div>
                <div class="step-status">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            <div class="arrow">‚Üí</div>
            <div class="step" onclick="showStep(5)" id="step5">
                <div class="step-icon">üöÄ</div>
                <div class="step-title">5. –ó–∞–ª–∏–≤–∫–∞</div>
                <div class="step-status">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            <div class="arrow">‚Üí</div>
            <div class="step" onclick="showStep(6)" id="step6">
                <div class="step-icon">üìä</div>
                <div class="step-title">6. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="step-status">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            <div class="arrow">‚Üí</div>
            <div class="step" onclick="showStep(7)" id="step7">
                <div class="step-icon">üõí</div>
                <div class="step-title">7. –ú–∞–≥–∞–∑–∏–Ω</div>
                <div class="step-status">DarkShop/PX6</div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Main Panel -->
            <div class="panel">
                <!-- Step 1: –ù–∞—Ä–µ–∑–∫–∞ -->
                <div class="tab-content active" id="content1">
                    <h2>üìπ –≠—Ç–∞–ø 1: –ù–∞—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ</h2>
                    
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è –Ω–∞—Ä–µ–∑–∫–∏</label>
                        <select id="masterVideo" onchange="updateVideoInfo()">
                            <option value="">-- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ --</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadMasterVideos()" style="margin-top: 10px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    </div>
                    
                    <div id="videoInfo" style="display: none; margin-bottom: 20px; padding: 15px; background: #16213e; border-radius: 10px;">
                        <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> <span id="videoDuration">-</span></p>
                        <p><strong>–†–∞–∑–º–µ—Ä:</strong> <span id="videoSize">-</span></p>
                        <p><strong>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</strong> <span id="videoRes">-</span></p>
                    </div>
                    
                    <div class="form-group">
                        <label>–î–ª–∏–Ω–∞ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–ø–∞ (—Å–µ–∫—É–Ω–¥)</label>
                        <input type="number" id="segmentDuration" value="30" min="5" max="180">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="text" id="folderName" placeholder="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏">
                    </div>
                    
                    <div id="cutPreview" style="margin-bottom: 20px; padding: 15px; background: #16213e; border-radius: 10px;">
                        <p>üìä –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–ø–æ–≤: <strong id="estimatedCuts">-</strong></p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="startCutting()">‚úÇÔ∏è –ù–∞—á–∞—Ç—å –Ω–∞—Ä–µ–∑–∫—É</button>
                    
                    <div class="progress-container" id="cutProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="cutProgressFill" style="width: 0%">0%</div>
                        </div>
                        <p class="progress-text" id="cutProgressText">–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
                    </div>
                </div>
                
                <!-- Step 2: –£–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è -->
                <div class="tab-content" id="content2">
                    <h2>‚ú® –≠—Ç–∞–ø 2: –£–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ</h2>
                    
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –≤–∏–¥–µ–æ</label>
                        <select id="sourceFolder">
                            <option value="">-- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ --</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadFolders('cuts')" style="margin-top: 10px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    </div>
                    
                    <div class="form-group">
                        <label>–ü—Ä–µ—Å–µ—Ç —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏–∏</label>
                        <div class="preset-cards">
                            <div class="preset-card" onclick="selectPreset('minimal')">
                                <div class="preset-name">üîπ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π</div>
                                <div class="preset-desc">–ü–æ—á—Ç–∏ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ</div>
                            </div>
                            <div class="preset-card selected" onclick="selectPreset('balanced')">
                                <div class="preset-name">‚öñÔ∏è –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</div>
                                <div class="preset-desc">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</div>
                            </div>
                            <div class="preset-card" onclick="selectPreset('aggressive')">
                                <div class="preset-name">üî• –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π</div>
                                <div class="preset-desc">–ú–∞–∫—Å–∏–º—É–º –∏–∑–º–µ–Ω–µ–Ω–∏–π</div>
                            </div>
                        </div>
                        <input type="hidden" id="selectedPreset" value="balanced">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ä—Å–∏–π –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ</label>
                        <input type="number" id="uniqueCount" value="5" min="1" max="50">
                    </div>
                    
                    <button class="btn btn-primary" onclick="startUniquify()">‚ú® –£–Ω–∏–∫–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                    
                    <div class="progress-container" id="uniqueProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="uniqueProgressFill" style="width: 0%">0%</div>
                        </div>
                        <p class="progress-text" id="uniqueProgressText">–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
                    </div>
                </div>
                
                <!-- Step 3: Sound ID -->
                <div class="tab-content" id="content3">
                    <h2>üéµ –≠—Ç–∞–ø 3: –ü–æ–ª—É—á–∏—Ç—å Sound ID</h2>
                    
                    <div style="background: #16213e; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                        <p style="color: #00d4ff; margin-bottom: 10px;">üí° <strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong></p>
                        <p style="color: #aaa; line-height: 1.6;">
                            –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∑–≤—É–∫ TikTok ‚Üí –ø–æ–ª—É—á–∏—Ç–µ Sound ID ‚Üí 
                            –ø—Ä–∏ –∑–∞–ª–∏–≤–∫–µ TikTok –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç —ç—Ç–æ—Ç –∑–≤—É–∫ –∫ –≤–∞—à–∏–º –≤–∏–¥–µ–æ.
                            <br><br>
                            <strong>–ó–≤—É–∫ –ù–ï –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∏–¥–µ–æ</strong> ‚Äî TikTok —Å–∞–º –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –µ–≥–æ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label>URL –∑–≤—É–∫–∞ TikTok</label>
                        <input type="text" id="tiktokSoundUrl" placeholder="https://vt.tiktok.com/... –∏–ª–∏ https://www.tiktok.com/music/...">
                        <p style="color: #666; font-size: 0.85em; margin-top: 5px;">
                            –ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∑–≤—É–∫ –∏–ª–∏ –Ω–∞ –≤–∏–¥–µ–æ —Å –Ω—É–∂–Ω—ã–º –∑–≤—É–∫–æ–º
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="parseTiktokSound()">üîç –ü–æ–ª—É—á–∏—Ç—å Sound ID</button>
                    
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ -->
                    <div id="parsedSoundInfo" style="display: none; margin-top: 25px; padding: 25px; background: linear-gradient(135deg, #1a2747 0%, #16213e 100%); border-radius: 12px; border: 2px solid #00ff88;">
                        <h4 style="color: #00ff88; margin-bottom: 20px; font-size: 1.2em;">‚úÖ Sound ID –ø–æ–ª—É—á–µ–Ω!</h4>
                        
                        <div style="background: #0a0a1a; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="color: #888; font-size: 0.85em; margin-bottom: 5px;">SOUND ID</p>
                            <code id="parsedSoundId" style="font-size: 1.3em; color: #00d4ff; word-break: break-all;">-</code>
                        </div>
                        
                        <p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> <span id="parsedSoundName" style="color: #fff;">-</span></p>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="copySoundId()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</button>
                            <button class="btn btn-success" onclick="showStep(4)">‚û°Ô∏è –î–∞–ª–µ–µ: –£–ø–∞–∫–æ–≤–∫–∞</button>
                        </div>
                        
                        <p style="margin-top: 20px; color: #888; font-size: 0.9em; padding: 10px; background: rgba(0,212,255,0.1); border-radius: 6px;">
                            üí° Sound ID —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –ù–∞ —à–∞–≥–µ 5 (–ó–∞–ª–∏–≤–∫–∞) –Ω–∞–∂–º–∏—Ç–µ "üìã –í—Å—Ç–∞–≤–∏—Ç—å" —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ.
                        </p>
                    </div>
                    
                    <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #333;">
                        <h4 style="color: #888; margin-bottom: 15px;">–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ Sound ID –≤—Ä—É—á–Ω—É—é:</h4>
                        <div class="form-group">
                            <input type="text" id="manualSoundId" placeholder="7572266043506149392">
                        </div>
                        <button class="btn btn-secondary" onclick="saveManualSoundId()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID</button>
                    </div>
                </div>
                
                <!-- Step 4: –£–ø–∞–∫–æ–≤–∫–∞ -->
                <div class="tab-content" id="content4">
                    <h2>üì¶ –≠—Ç–∞–ø 4: –£–ø–∞–∫–æ–≤–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                    
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É</label>
                        <select id="zipFolder">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É --</option>
                        </select>
                        <button class="btn btn-secondary" onclick="loadFolders('all', 'zipFolder')" style="margin-top: 10px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                    
                    <div id="folderInfo" style="margin-bottom: 20px; padding: 15px; background: #16213e; border-radius: 10px;">
                        <p><strong>–í–∏–¥–µ–æ:</strong> <span id="folderVideoCount">-</span></p>
                        <p><strong>–†–∞–∑–º–µ—Ä:</strong> <span id="folderTotalSize">-</span></p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="createZip()">üì¶ –°–æ–∑–¥–∞—Ç—å ZIP</button>
                    
                    <h3 style="margin: 25px 0 15px;">üì¶ –ì–æ—Ç–æ–≤—ã–µ –∞—Ä—Ö–∏–≤—ã</h3>
                    <div class="file-list" id="zipList">
                        <p style="color: #888; text-align: center; padding: 20px;">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞</p>
                    </div>
                    <button class="btn btn-secondary" onclick="loadZips()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <!-- Step 5: –ó–∞–ª–∏–≤–∫–∞ -->
                <div class="tab-content" id="content5">
                    <h2>üöÄ –≠—Ç–∞–ø 5: –ó–∞–ª–∏–≤–∫–∞ –≤ TikTok</h2>
                    
                    <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤ -->
                    <div style="background: linear-gradient(135deg, #1a2747 0%, #16213e 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #333;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div class="stats-card" style="margin: 0;">
                                <h4>–í–∏–¥–µ–æ –≤ ZIP</h4>
                                <div class="stats-value" id="calcVideos">-</div>
                            </div>
                            <div class="stats-card" style="margin: 0;">
                                <h4>–ù—É–∂–Ω–æ –∞–∫–∫–æ–≤</h4>
                                <div class="stats-value" id="calcAccountsNeeded">-</div>
                                <div class="stats-label">–º–∞–∫—Å 6 –≤–∏–¥–µ–æ/–∞–∫–∫</div>
                            </div>
                            <div class="stats-card" style="margin: 0;">
                                <h4>–î–æ—Å—Ç—É–ø–Ω–æ –∞–∫–∫–æ–≤</h4>
                                <div class="stats-value" id="calcAccountsAvailable">-</div>
                            </div>
                            <div class="stats-card" style="margin: 0;">
                                <h4>–ù—É–∂–Ω–æ –ø—Ä–æ–∫—Å–∏</h4>
                                <div class="stats-value" id="calcProxiesNeeded">-</div>
                                <div class="stats-label">–º–∞–∫—Å 5 –∞–∫–∫/–ø—Ä–æ–∫—Å–∏</div>
                            </div>
                        </div>
                        
                        <!-- –°—Ç–∞—Ç—É—Å -->
                        <div id="resourceStatus" style="padding: 15px; border-radius: 8px; background: rgba(0,255,136,0.1); border: 1px solid #00ff88; display: none;">
                            <span id="resourceStatusText">‚úÖ –†–µ—Å—É—Ä—Å–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!</span>
                        </div>
                        
                        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è -->
                        <div id="resourceWarning" style="padding: 15px; border-radius: 8px; background: rgba(255,71,87,0.1); border: 1px solid #ff4757; display: none; margin-top: 10px;">
                            <span id="resourceWarningText">‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤</span>
                            <div style="margin-top: 10px;">
                                <a href="accounts.html" class="btn btn-danger" id="btnBuyAccounts" style="display: none; text-decoration: none;">üì• –ü–µ—Ä–µ–π—Ç–∏ –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º</a>
                                <button class="btn btn-warning" onclick="showStep(7)" id="btnBuyProxies" style="display: none; background: #ffa502;">üåê –ö—É–ø–∏—Ç—å –ø—Ä–æ–∫—Å–∏</button>
                            </div>
                        </div>
                        
                        <button class="btn btn-secondary" onclick="calculateResources()" style="margin-top: 15px;">üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button>
                    </div>
                    
                    <!-- –í—ã–±–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤ -->
                    <div style="background: #16213e; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #00d4ff; margin-bottom: 15px;">üë• –ê–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –∑–∞–ª–∏–≤–∫–∏</h4>
                        <div id="accountsList" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;">
                            <p style="color: #888;">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤...</p>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="loadAccounts()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                            <button class="btn btn-secondary" onclick="selectAllAccounts()">‚òëÔ∏è –í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                            <button class="btn btn-secondary" onclick="deselectAllAccounts()">‚úñÔ∏è –°–Ω—è—Ç—å –≤—Å–µ</button>
                            <a href="accounts.html" class="btn btn-success" style="margin-left: auto; text-decoration: none;">üì• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</a>
                        </div>
                        <p style="color: #888; font-size: 0.85em; margin-top: 10px;">
                            ‚ö†Ô∏è –õ–∏–º–∏—Ç—ã: –º–∞–∫—Å 6 –≤–∏–¥–µ–æ/–¥–µ–Ω—å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç, –º–∞–∫—Å 5 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ 1 –ø—Ä–æ–∫—Å–∏
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label>TikTok Backend API (—Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä)</label>
                        <input type="text" id="tiktokApiUrl" value="https://upl.synthnova.me">
                    </div>
                    
                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ ZIP –∞—Ä—Ö–∏–≤</label>
                        <select id="uploadZip">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä—Ö–∏–≤ --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ (caption)</label>
                        <textarea id="caption" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤–∏–¥–µ–æ #fyp #viral"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Sound ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –∑–≤—É–∫ TikTok)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="uploadSoundId" placeholder="7572266043506149392">
                            <button class="btn btn-secondary" onclick="loadSavedSoundId()">üìã –í—Å—Ç–∞–≤–∏—Ç—å</button>
                        </div>
                        <p style="color: #888; font-size: 0.85em; margin-top: 5px;">
                            –ü–æ–ª—É—á–∏—Ç–µ Sound ID –Ω–∞ —à–∞–≥–µ 3 (–≤–∫–ª–∞–¥–∫–∞ TikTok URL)
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞—á–∞–ª–æ –∑–≤—É–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)</label>
                        <input type="number" id="uploadSoundStart" value="0" min="0" step="1" placeholder="–° –∫–∞–∫–æ–π —Å–µ–∫—É–Ω–¥—ã –Ω–∞—á–∞—Ç—å –∑–≤—É–∫">
                    </div>
                    
                    <button class="btn btn-success" onclick="startUpload()">üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ TikTok</button>
                    
                    <div class="progress-container" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="uploadProgressFill" style="width: 0%">0%</div>
                        </div>
                        <p class="progress-text" id="uploadProgressText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>
                
                <!-- Step 6: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="tab-content" id="content6">
                    <h2>üìä –≠—Ç–∞–ø 6: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                        <div class="stats-card">
                            <h4>–ê–∫–∫–∞—É–Ω—Ç—ã</h4>
                            <div class="stats-value" id="totalAccounts">-</div>
                            <div class="stats-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
                        </div>
                        <div class="stats-card">
                            <h4>–ü—Ä–æ–∫—Å–∏</h4>
                            <div class="stats-value" id="totalProxies">-</div>
                            <div class="stats-label">–ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
                        </div>
                        <div class="stats-card">
                            <h4>–í–∏–¥–µ–æ</h4>
                            <div class="stats-value" id="totalVideos">-</div>
                            <div class="stats-label">–∑–∞–≥—Ä—É–∂–µ–Ω–æ</div>
                        </div>
                        <div class="stats-card">
                            <h4>–£—Å–ø–µ—à–Ω–æ</h4>
                            <div class="stats-value" id="successRate">-</div>
                            <div class="stats-label">–ø—Ä–æ—Ü–µ–Ω—Ç</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="loadStats()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                    <button class="btn btn-secondary" onclick="loadAccountStats()">üë• –ê–∫–∫–∞—É–Ω—Ç—ã</button>
                </div>
                
                <!-- Step 7: –ú–∞–≥–∞–∑–∏–Ω -->
                <div class="tab-content" id="content7">
                    <h2>üõí –≠—Ç–∞–ø 7: –ú–∞–≥–∞–∑–∏–Ω –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∏ –ø—Ä–æ–∫—Å–∏</h2>
                    
                    <div class="tabs">
                        <div class="tab active" onclick="showShopTab('accounts')">üë• –ê–∫–∫–∞—É–Ω—Ç—ã</div>
                        <div class="tab" onclick="showShopTab('proxies')">üåê –ü—Ä–æ–∫—Å–∏ (PX6)</div>
                    </div>
                    
                    <!-- Accounts Management -->
                    <div class="shop-tab-content" id="shopAccounts">
                        <div style="background: #16213e; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #00d4ff; margin-bottom: 15px;">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</h4>
                            <p style="color: #888; margin-bottom: 15px;">–ò–º–ø–æ—Ä—Ç, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø—Ä–æ–≥—Ä–µ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ TikTok, YouTube, Instagram</p>
                            <a href="accounts.html" class="btn btn-primary" style="text-decoration: none; display: inline-block;">üì• –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤</a>
                        </div>
                        
                        <div style="background: #16213e; padding: 20px; border-radius: 10px;">
                            <h4 style="color: #00d4ff; margin-bottom: 15px;">üìä –¢–∏–ø—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h4>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                <div style="background: rgba(255,165,2,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #ffa502;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">üç™</div>
                                    <div style="font-weight: bold; color: #ffa502;">Cookie</div>
                                    <div style="color: #888; font-size: 0.85em;">–í—Ö–æ–¥ –ø–æ cookies, –±—ã—Å—Ç—Ä–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</div>
                                </div>
                                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #00d4ff;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">üîê</div>
                                    <div style="font-weight: bold; color: #00d4ff;">Login</div>
                                    <div style="color: #888; font-size: 0.85em;">Email/–ø–∞—Ä–æ–ª—å + –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—á—Ç—ã</div>
                                </div>
                                <div style="background: rgba(123,44,191,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #a55eea;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">ü§ñ</div>
                                    <div style="font-weight: bold; color: #a55eea;">Autoreg</div>
                                    <div style="color: #888; font-size: 0.85em;">–°–≤–µ–∂–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã, —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≥—Ä–µ–≤–∞</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PX6 Proxies -->
                    <div class="shop-tab-content" id="shopProxies" style="display: none;">
                        <div style="background: #16213e; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: #00d4ff; margin-bottom: 15px;">üí∞ –ë–∞–ª–∞–Ω—Å PX6</h4>
                            <div class="stats-value" id="px6Balance">-</div>
                            <div class="stats-label">—Ä—É–±–ª–µ–π</div>
                            <button class="btn btn-secondary" onclick="checkPx6Balance()" style="margin-top: 10px;">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                        </div>
                        
                        <div class="form-group">
                            <label>–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∫—Å–∏</label>
                            <select id="px6Country">
                                <option value="us">üá∫üá∏ –°–®–ê</option>
                                <option value="ru">üá∑üá∫ –†–æ—Å—Å–∏—è</option>
                                <option value="de">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
                                <option value="gb">üá¨üáß –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Å–∏</label>
                            <input type="number" id="px6Quantity" value="1" min="1" max="50">
                        </div>
                        
                        <div class="form-group">
                            <label>–ü–µ—Ä–∏–æ–¥ (–¥–Ω–µ–π)</label>
                            <select id="px6Period">
                                <option value="7">7 –¥–Ω–µ–π</option>
                                <option value="30" selected>30 –¥–Ω–µ–π</option>
                                <option value="90">90 –¥–Ω–µ–π</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-success" onclick="buyPx6Proxies()">üõí –ö—É–ø–∏—Ç—å –ø—Ä–æ–∫—Å–∏</button>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #0a0a1a; border-radius: 8px;">
                            <h5 style="color: #888; margin-bottom: 10px;">üåê –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–∫—Å–∏</h5>
                            <div id="px6ProxiesList" style="max-height: 150px; overflow-y: auto;">
                                <p style="color: #666;">–°–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Log Panel -->
                <h3 style="margin-top: 25px; margin-bottom: 15px;">üìã –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                <div class="log-panel" id="logPanel">
                    <div class="log-entry info">[INFO] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∂–µ–Ω. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ API.</div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="panel">
                <h2>üìä –û–±–∑–æ—Ä</h2>
                
                <div class="stats-card">
                    <h4>Video Cutter</h4>
                    <div id="cutterStats">
                        <p>–ú–∞—Å—Ç–µ—Ä-–≤–∏–¥–µ–æ: <strong id="masterCount">-</strong></p>
                        <p>–ü–∞–ø–æ–∫ —Å –Ω–∞—Ä–µ–∑–∫–∞–º–∏: <strong id="cutsCount">-</strong></p>
                        <p>–£–Ω–∏–∫–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: <strong id="uniqueCount2">-</strong></p>
                    </div>
                </div>
                
                <div class="stats-card">
                    <h4>–ó–≤—É–∫–∏</h4>
                    <p>–í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ: <strong id="soundsCount">-</strong></p>
                </div>
                
                <div class="stats-card">
                    <h4>–ê—Ä—Ö–∏–≤—ã</h4>
                    <p>ZIP —Ñ–∞–π–ª–æ–≤: <strong id="zipsCount">-</strong></p>
                </div>
                
                <button class="btn btn-primary" onclick="refreshAll()" style="width: 100%; margin-top: 15px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≤—Å—ë</button>
                
                <hr style="margin: 20px 0; border-color: #333;">
                
                <h3 style="margin-bottom: 15px;">üéØ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                
                <button class="btn btn-secondary" onclick="loadCutterStats()" style="width: 100%; margin-bottom: 10px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Cutter</button>
                <button class="btn btn-secondary" onclick="window.open(document.getElementById('apiUrl').value, '_blank')" style="width: 100%;">üîó –û—Ç–∫—Ä—ã—Ç—å API</button>
            </div>
        </div>
    </div>
    
    <script>
        // Global state
        let currentStep = 1;
        let selectedSound = null;
        let availableAccounts = [];
        let selectedAccounts = [];
        let currentJob = null;
        let currentEventSource = null;
        
        // API URL
        function getApiUrl() {
            return document.getElementById('apiUrl').value || 'http://localhost:8080';
        }
        
        // Logging
        function log(message, type = 'info') {
            const logPanel = document.getElementById('logPanel');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logPanel.appendChild(entry);
            logPanel.scrollTop = logPanel.scrollHeight;
        }
        
        // Show step
        function showStep(step) {
            // Update step indicators
            document.querySelectorAll('.step').forEach((el, i) => {
                el.classList.remove('active');
                if (i + 1 === step) el.classList.add('active');
            });
            
            // Show content
            document.querySelectorAll('.tab-content').forEach((el, i) => {
                el.classList.remove('active');
                if (i + 1 === step) el.classList.add('active');
            });
            
            currentStep = step;
            
            // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —à–∞–≥
            if (step === 4) {
                loadFolders('all', 'zipFolder');
                loadZips();
            }
            if (step === 5) {
                loadZips();
            }
            if (step === 6) {
                loadStats();
            }
        }
        
        // Test connection
        async function testConnection() {
            const statusEl = document.getElementById('apiStatus');
            try {
                const response = await fetch(`${getApiUrl()}/cutter/stats`);
                if (response.ok) {
                    statusEl.className = 'api-status connected';
                    statusEl.textContent = '‚óè –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    log('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API —É—Å–ø–µ—à–Ω–æ', 'success');
                    refreshAll();
                } else {
                    throw new Error('API error');
                }
            } catch (e) {
                statusEl.className = 'api-status disconnected';
                statusEl.textContent = '‚óè –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
                log(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${e.message}`, 'error');
            }
        }
        
        // Load master videos
        async function loadMasterVideos() {
            try {
                const response = await fetch(`${getApiUrl()}/cutter/list-videos`);
                const data = await response.json();
                
                const select = document.getElementById('masterVideo');
                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ --</option>';
                
                if (data.videos) {
                    data.videos.forEach(v => {
                        const option = document.createElement('option');
                        option.value = v.filename;
                        option.textContent = `${v.filename} (${v.duration_formatted}, ${v.size_mb} MB)`;
                        option.dataset.duration = v.duration;
                        option.dataset.size = v.size_mb;
                        option.dataset.width = v.width;
                        option.dataset.height = v.height;
                        select.appendChild(option);
                    });
                    document.getElementById('masterCount').textContent = data.videos.length;
                    log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.videos.length} –≤–∏–¥–µ–æ`, 'success');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${e.message}`, 'error');
            }
        }
        
        // Update video info
        function updateVideoInfo() {
            const select = document.getElementById('masterVideo');
            const option = select.options[select.selectedIndex];
            const infoDiv = document.getElementById('videoInfo');
            
            if (option && option.value) {
                document.getElementById('videoDuration').textContent = option.dataset.duration ? formatTime(parseFloat(option.dataset.duration)) : '-';
                document.getElementById('videoSize').textContent = `${option.dataset.size} MB`;
                document.getElementById('videoRes').textContent = `${option.dataset.width}x${option.dataset.height}`;
                infoDiv.style.display = 'block';
                
                // Estimate cuts
                const duration = parseFloat(option.dataset.duration) || 0;
                const segment = parseInt(document.getElementById('segmentDuration').value) || 30;
                const estimated = Math.ceil(duration / segment);
                document.getElementById('estimatedCuts').textContent = estimated;
            } else {
                infoDiv.style.display = 'none';
            }
        }
        
        // Format time
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }
        
        // Start cutting
        async function startCutting() {
            const filename = document.getElementById('masterVideo').value;
            const segmentDuration = parseInt(document.getElementById('segmentDuration').value);
            const folderName = document.getElementById('folderName').value;
            
            if (!filename) {
                log('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è –Ω–∞—Ä–µ–∑–∫–∏', 'warning');
                return;
            }
            
            try {
                log(`–ù–∞—á–∏–Ω–∞–µ–º –Ω–∞—Ä–µ–∑–∫—É: ${filename}`, 'info');
                
                const response = await fetch(`${getApiUrl()}/cutter/cut`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename,
                        segment_duration: segmentDuration,
                        folder_name: folderName || undefined
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentJob = data.job_id;
                    document.getElementById('cutProgress').style.display = 'block';
                    log(`–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: ${data.job_id}`, 'success');
                    pollJobStatus(data.job_id, 'cut');
                } else {
                    log(`–û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Poll job status
        async function pollJobStatus(jobId, type) {
            const progressEl = document.getElementById(`${type}ProgressFill`);
            const textEl = document.getElementById(`${type}ProgressText`);
            
            const poll = async () => {
                try {
                    const response = await fetch(`${getApiUrl()}/cutter/job/${jobId}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        progressEl.style.width = `${data.progress}%`;
                        progressEl.textContent = `${data.progress}%`;
                        textEl.textContent = data.message || '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
                        
                        if (data.status === 'completed') {
                            log(`–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${jobId}`, 'success');
                            document.getElementById(`step${currentStep}`).classList.add('completed');
                            document.querySelector(`#step${currentStep} .step-status`).textContent = '–ì–æ—Ç–æ–≤–æ!';
                            return;
                        } else if (data.status === 'error') {
                            log(`–û—à–∏–±–∫–∞ –∑–∞–¥–∞—á–∏: ${data.error}`, 'error');
                            return;
                        }
                    }
                    
                    setTimeout(poll, 2000);
                } catch (e) {
                    log(`–û—à–∏–±–∫–∞ –æ–ø—Ä–æ—Å–∞: ${e.message}`, 'error');
                }
            };
            
            poll();
        }
        
        // Load folders
        async function loadFolders(type = 'cuts', targetSelect = 'sourceFolder') {
            try {
                const response = await fetch(`${getApiUrl()}/cutter/folders?type=${type}`);
                const data = await response.json();
                
                const select = document.getElementById(targetSelect);
                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É --</option>';
                
                if (data.folders) {
                    data.folders.forEach(f => {
                        const option = document.createElement('option');
                        option.value = f.name;
                        option.textContent = `${f.name} (${f.files_count} —Ñ–∞–π–ª–æ–≤, ${f.total_size_mb} MB)`;
                        select.appendChild(option);
                    });
                    
                    if (type === 'cuts') {
                        document.getElementById('cutsCount').textContent = data.folders.filter(f => f.type === 'cuts').length;
                        document.getElementById('uniqueCount2').textContent = data.folders.filter(f => f.type === 'uniquified').length;
                    }
                    
                    log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.folders.length} –ø–∞–ø–æ–∫`, 'success');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–ø–æ–∫: ${e.message}`, 'error');
            }
        }
        
        // Select preset
        function selectPreset(preset) {
            document.querySelectorAll('.preset-card').forEach(el => el.classList.remove('selected'));
            event.target.closest('.preset-card').classList.add('selected');
            document.getElementById('selectedPreset').value = preset;
        }
        
        // Start uniquify
        async function startUniquify() {
            const sourceFolder = document.getElementById('sourceFolder').value;
            const preset = document.getElementById('selectedPreset').value;
            const count = parseInt(document.getElementById('uniqueCount').value);
            
            if (!sourceFolder) {
                log('–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –≤–∏–¥–µ–æ', 'warning');
                return;
            }
            
            try {
                log(`–ù–∞—á–∏–Ω–∞–µ–º —É–Ω–∏–∫–∞–ª–∏–∑–∞—Ü–∏—é: ${sourceFolder}`, 'info');
                
                const response = await fetch(`${getApiUrl()}/cutter/uniquify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        source_folder: sourceFolder,
                        preset,
                        count
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('uniqueProgress').style.display = 'block';
                    log(`–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: ${data.job_id}`, 'success');
                    pollJobStatus(data.job_id, 'unique');
                } else {
                    log(`–û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Parse TikTok sound URL to get Sound ID
        let currentSoundId = null;
        let currentSoundName = null;
        
        async function parseTiktokSound() {
            const url = document.getElementById('tiktokSoundUrl').value.trim();
            
            if (!url) {
                log('–í–≤–µ–¥–∏—Ç–µ URL –∑–≤—É–∫–∞ TikTok', 'warning');
                return;
            }
            
            log(`–ü–∞—Ä—Å–∏–º Sound ID –∏–∑ URL...`, 'info');
            
            try {
                const response = await fetch(`${getApiUrl()}/cutter/parse-sound-url`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentSoundId = data.sound_id;
                    currentSoundName = data.sound_name;
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    document.getElementById('parsedSoundInfo').style.display = 'block';
                    document.getElementById('parsedSoundId').textContent = data.sound_id;
                    document.getElementById('parsedSoundName').textContent = data.sound_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    
                    log(`‚úÖ Sound ID: ${data.sound_id}`, 'success');
                    log(`üéµ –ù–∞–∑–≤–∞–Ω–∏–µ: ${data.sound_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`, 'info');
                    
                    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–ª–∏–≤–∫–µ
                    localStorage.setItem('tiktok_sound_id', data.sound_id);
                    localStorage.setItem('tiktok_sound_name', data.sound_name || '');
                    
                } else {
                    log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å Sound ID: ${data.error}`, 'error');
                    document.getElementById('parsedSoundInfo').style.display = 'none';
                }
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${e.message}`, 'error');
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å Sound ID –≤ –±—É—Ñ–µ—Ä
        function copySoundId() {
            if (currentSoundId) {
                navigator.clipboard.writeText(currentSoundId);
                log(`üìã Sound ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ${currentSoundId}`, 'success');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π Sound ID –≤ –ø–æ–ª–µ –∑–∞–ª–∏–≤–∫–∏
        function loadSavedSoundId() {
            const savedId = localStorage.getItem('tiktok_sound_id');
            const savedName = localStorage.getItem('tiktok_sound_name');
            
            if (savedId) {
                document.getElementById('uploadSoundId').value = savedId;
                log(`üìã Sound ID –≤—Å—Ç–∞–≤–ª–µ–Ω: ${savedId} (${savedName || '–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'})`, 'success');
            } else {
                log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ Sound ID –Ω–∞ —à–∞–≥–µ 3', 'warning');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é –≤–≤–µ–¥—ë–Ω–Ω—ã–π Sound ID
        function saveManualSoundId() {
            const soundId = document.getElementById('manualSoundId').value.trim();
            
            if (!soundId) {
                log('–í–≤–µ–¥–∏—Ç–µ Sound ID', 'warning');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ ID (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, 15-25 —Å–∏–º–≤–æ–ª–æ–≤)
            if (!/^\d{15,25}$/.test(soundId)) {
                log('‚ö†Ô∏è Sound ID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 15-25 —Ü–∏—Ñ—Ä', 'warning');
                return;
            }
            
            localStorage.setItem('tiktok_sound_id', soundId);
            localStorage.setItem('tiktok_sound_name', '–†—É—á–Ω–æ–π –≤–≤–æ–¥');
            currentSoundId = soundId;
            
            log(`‚úÖ Sound ID —Å–æ—Ö—Ä–∞–Ω—ë–Ω: ${soundId}`, 'success');
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('parsedSoundInfo').style.display = 'block';
            document.getElementById('parsedSoundId').textContent = soundId;
            document.getElementById('parsedSoundName').textContent = '–í–≤–µ–¥—ë–Ω –≤—Ä—É—á–Ω—É—é';
        }
        
        // Select sound
        function selectSoundItem(filename, element) {
            document.querySelectorAll('.sound-item').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedSound = filename;
            log(`–í—ã–±—Ä–∞–Ω –∑–≤—É–∫: ${filename}`, 'info');
        }
        
        // Volume slider
        document.getElementById('soundVolume').addEventListener('input', function() {
            document.getElementById('volumeValue').textContent = this.value;
        });
        
        // Add sound batch
        async function addSoundBatch() {
            const sourceFolder = document.getElementById('soundVideoFolder').value;
            const soundStart = parseFloat(document.getElementById('soundStart').value);
            const volume = parseFloat(document.getElementById('soundVolume').value);
            const mixMode = document.getElementById('mixMode').value;
            
            if (!sourceFolder) {
                log('–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –≤–∏–¥–µ–æ', 'warning');
                return;
            }
            
            if (!selectedSound) {
                log('–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤—É–∫ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏', 'warning');
                return;
            }
            
            try {
                log(`–î–æ–±–∞–≤–ª—è–µ–º –∑–≤—É–∫ –∫ –≤–∏–¥–µ–æ –≤ –ø–∞–ø–∫–µ: ${sourceFolder}`, 'info');
                
                const response = await fetch(`${getApiUrl()}/cutter/add-sound-batch`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        source_folder: sourceFolder,
                        sound_file: selectedSound,
                        sound_start: soundStart,
                        volume,
                        mix_mode: mixMode
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: ${data.job_id}`, 'success');
                    pollJobStatus(data.job_id, 'unique');
                } else {
                    log(`–û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Load ZIPs
        async function loadZips() {
            try {
                const response = await fetch(`${getApiUrl()}/cutter/list-zips`);
                const data = await response.json();
                
                const list = document.getElementById('zipList');
                const select = document.getElementById('uploadZip');
                list.innerHTML = '';
                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä—Ö–∏–≤ --</option>';
                
                if (data.zips && data.zips.length > 0) {
                    data.zips.forEach(z => {
                        const item = document.createElement('div');
                        item.className = 'file-item';
                        item.innerHTML = `
                            <span class="file-name">üì¶ ${z.filename}</span>
                            <span class="file-size">${z.size_mb} MB</span>
                        `;
                        list.appendChild(item);
                        
                        const option = document.createElement('option');
                        option.value = z.filename;
                        option.textContent = `${z.filename} (${z.size_mb} MB)`;
                        select.appendChild(option);
                    });
                    document.getElementById('zipsCount').textContent = data.zips.length;
                    log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.zips.length} –∞—Ä—Ö–∏–≤–æ–≤`, 'success');
                } else {
                    list.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">–ù–µ—Ç –∞—Ä—Ö–∏–≤–æ–≤</p>';
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–æ–≤: ${e.message}`, 'error');
            }
        }
        
        // Create ZIP
        async function createZip() {
            const folderName = document.getElementById('zipFolder').value;
            
            if (!folderName) {
                log('–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏', 'warning');
                return;
            }
            
            try {
                log(`–°–æ–∑–¥–∞—ë–º ZIP: ${folderName}`, 'info');
                
                const response = await fetch(`${getApiUrl()}/cutter/create-zip/${folderName}`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`ZIP —Å–æ–∑–¥–∞–Ω: ${data.zip_filename} (${data.size_mb} MB)`, 'success');
                    loadZips();
                } else {
                    log(`–û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Load cutter stats
        async function loadCutterStats() {
            try {
                const response = await fetch(`${getApiUrl()}/cutter/stats`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('masterCount').textContent = data.masters?.files || 0;
                    document.getElementById('cutsCount').textContent = data.cuts?.folders || 0;
                    document.getElementById('uniqueCount2').textContent = data.uniquified?.folders || 0;
                    log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                }
            } catch (e) {
                log(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Refresh all
        async function refreshAll() {
            await loadMasterVideos();
            await loadFolders('all');
            await loadFolders('all', 'zipFolder');
            await loadZips();
            await loadCutterStats();
        }
        
        // Start TikTok upload
        async function startUpload() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            const zipFile = document.getElementById('uploadZip').value;
            const caption = document.getElementById('caption').value;
            const soundId = document.getElementById('uploadSoundId').value.trim();
            const soundStart = parseInt(document.getElementById('uploadSoundStart').value) || 0;
            
            if (!zipFile) {
                log('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ ZIP –∞—Ä—Ö–∏–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'warning');
                return;
            }
            
            if (!caption) {
                log('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ (caption)', 'warning');
                return;
            }
            
            if (selectedAccounts.length === 0) {
                log('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –∑–∞–ª–∏–≤–∫–∏', 'warning');
                return;
            }
            
            log(`üë• –í—ã–±—Ä–∞–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ${selectedAccounts.length}`, 'info');
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('uploadProgressFill').style.width = '10%';
            document.getElementById('uploadProgressText').textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...';
            
            log(`üöÄ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É: ${zipFile}`, 'info');
            if (soundId) {
                log(`üéµ Sound ID: ${soundId}, –Ω–∞—á–∞–ª–æ: ${soundStart}—Å`, 'info');
            }
            
            try {
                // Backend –æ–∂–∏–¥–∞–µ—Ç multipart/form-data —Å —Ñ–∞–π–ª–∞–º–∏
                // –ù–æ —É –Ω–∞—Å ZIP –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ (Video Cutter API)
                // –ù—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —Å–∫–∞—á–∞—Ç—å ZIP, –ø–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ TikTok backend
                
                log(`üì• –ü–æ–ª—É—á–∞–µ–º ZIP —Ñ–∞–π–ª...`, 'info');
                document.getElementById('uploadProgressFill').style.width = '20%';
                
                // –°–∫–∞—á–∏–≤–∞–µ–º ZIP —Å Video Cutter API
                const zipUrl = `${getApiUrl()}/video-outputs/${zipFile}`;
                const zipResponse = await fetch(zipUrl);
                
                if (!zipResponse.ok) {
                    throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å ZIP: ${zipResponse.status}`);
                }
                
                const zipBlob = await zipResponse.blob();
                log(`‚úÖ ZIP –ø–æ–ª—É—á–µ–Ω: ${(zipBlob.size / 1024 / 1024).toFixed(2)} MB`, 'success');
                
                document.getElementById('uploadProgressFill').style.width = '40%';
                document.getElementById('uploadProgressText').textContent = '–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤...';
                
                // –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª accounts.txt –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
                const selectedAccountsData = availableAccounts.filter(a => selectedAccounts.includes(a.id));
                const accountsText = selectedAccountsData.map(a => `${a.username}:${a.password}`).join('\n');
                const accountsBlob = new Blob([accountsText], { type: 'text/plain' });
                
                // –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª proxies.txt
                const proxiesText = selectedAccountsData
                    .filter(a => a.proxy)
                    .map(a => `${a.proxy.host}:${a.proxy.port}:${a.proxy.username || ''}:${a.proxy.password || ''}`)
                    .join('\n');
                const proxiesBlob = new Blob([proxiesText], { type: 'text/plain' });
                
                log(`üìù –ê–∫–∫–∞—É–Ω—Ç–æ–≤: ${selectedAccountsData.length}, –ü—Ä–æ–∫—Å–∏: ${proxiesText.split('\n').filter(p=>p).length}`, 'info');
                
                document.getElementById('uploadProgressFill').style.width = '60%';
                document.getElementById('uploadProgressText').textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä...';
                
                // –°–æ–∑–¥–∞—ë–º FormData
                const formData = new FormData();
                formData.append('videos', zipBlob, zipFile);
                formData.append('accounts', accountsBlob, 'accounts.txt');
                formData.append('proxies', proxiesBlob, 'proxies.txt');
                formData.append('caption', caption);
                if (soundId) {
                    formData.append('sound_id', soundId);
                    formData.append('sound_start', soundStart.toString());
                }
                
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ ${tiktokApi}/api/batch-upload...`, 'info');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ TikTok backend
                const response = await fetch(`${tiktokApi}/api/batch-upload`, {
                    method: 'POST',
                    body: formData
                });
                
                document.getElementById('uploadProgressFill').style.width = '80%';
                
                const data = await response.json();
                
                if (data.success || data.batchId || data.data) {
                    document.getElementById('uploadProgressFill').style.width = '100%';
                    document.getElementById('uploadProgressText').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!';
                    
                    // –ü–æ–ª—É—á–∏—Ç—å batchId –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–µ—Å—Ç –≤ –æ—Ç–≤–µ—Ç–µ
                    const batchId = data.data?.batchId || data.batchId || data.data?.id || data.id;
                    const totalVideos = data.data?.totalVideos || data.totalVideos || '?';
                    
                    log(`‚úÖ Batch —Å–æ–∑–¥–∞–Ω: ${batchId}`, 'success');
                    log(`üìä –í–∏–¥–µ–æ –≤ –æ—á–µ—Ä–µ–¥–∏: ${totalVideos}`, 'info');
                    
                    // –û—Ç–º–µ—Ç–∏—Ç—å —à–∞–≥ –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π
                    document.getElementById('step5').classList.add('completed');
                    document.querySelector('#step5 .step-status').textContent = '–í –ø—Ä–æ—Ü–µ—Å—Å–µ...';
                    
                    // –ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                    if (batchId && batchId !== 'undefined') {
                        log(`üì° –ù–∞—á–∏–Ω–∞—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞...`, 'info');
                        startBatchTracking(tiktokApi, batchId);
                    } else {
                        // –ï—Å–ª–∏ batchId –Ω–µ –ø–æ–ª—É—á–µ–Ω, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞—Ç—á
                        log(`‚ö†Ô∏è BatchId –Ω–µ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–∞—Ç—á–µ–π...`, 'warning');
                        setTimeout(async () => {
                            try {
                                const batchesResp = await fetch(`${tiktokApi}/api/batches`);
                                const batchesData = await batchesResp.json();
                                if (batchesData.success && batchesData.data && batchesData.data.length > 0) {
                                    const latestBatch = batchesData.data[0];
                                    log(`‚úÖ –ù–∞–π–¥–µ–Ω –±–∞—Ç—á: ${latestBatch.id}`, 'success');
                                    log(`üìä –°—Ç–∞—Ç—É—Å: ${latestBatch.status}, –í–∏–¥–µ–æ: ${latestBatch.totalVideos}`, 'info');
                                    startBatchTracking(tiktokApi, latestBatch.id);
                                }
                            } catch (e) {
                                log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞—Ç—á–µ–π`, 'error');
                            }
                        }, 2000);
                    }
                } else {
                    throw new Error(data.error || data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
                
            } catch (e) {
                document.getElementById('uploadProgressFill').style.width = '0%';
                document.getElementById('uploadProgressText').textContent = '–û—à–∏–±–∫–∞!';
                
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${e.message}`, 'error');
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
                if (e.message.includes('Failed to fetch') || e.message.includes('NetworkError')) {
                    log(`üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ`, 'warning');
                } else if (e.message.includes('DOCTYPE')) {
                    log(`üí° Endpoint –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API`, 'warning');
                }
            }
        }
        
        // Load stats
        async function loadStats() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                const response = await fetch(`${tiktokApi}/api/managed-accounts/stats`);
                const data = await response.json();
                
                document.getElementById('totalAccounts').textContent = data.total || '-';
                document.getElementById('totalProxies').textContent = data.withProxy || '-';
                log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ TikTok –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            } catch (e) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${e.message}`, 'error');
            }
        }
        
        // Load account stats
        async function loadAccountStats() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                log(`üìä –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–∫–∫–∞—É–Ω—Ç–æ–≤...`, 'info');
                const response = await fetch(`${tiktokApi}/api/managed-accounts`);
                const data = await response.json();
                
                if (data.accounts || Array.isArray(data)) {
                    const accounts = data.accounts || data;
                    log(`‚úÖ –ê–∫–∫–∞—É–Ω—Ç–æ–≤: ${accounts.length}`, 'success');
                    
                    accounts.forEach((acc, i) => {
                        const status = acc.proxyId ? '‚úÖ' : '‚ö†Ô∏è';
                        log(`   ${i+1}. ${acc.username || acc.email} ${status}`, 'info');
                    });
                }
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Segment duration change
        document.getElementById('segmentDuration').addEventListener('input', updateVideoInfo);
        
        // ==================== BATCH TRACKING ====================
        
        function startBatchTracking(apiUrl, batchId) {
            // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
            if (currentEventSource) {
                currentEventSource.close();
            }
            
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–µ–º polling (–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ —á–µ—Ä–µ–∑ CORS)
            log(`üì° –ù–∞—á–∏–Ω–∞—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–∞—Ç—á–∞ ${batchId.slice(0, 8)}...`, 'info');
            pollBatchStatus(apiUrl, batchId);
            
            // –ü–æ–ø—Ä–æ–±—É–µ–º —Ç–∞–∫–∂–µ SSE –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
            const sseUrl = `${apiUrl}/api/batches/${batchId}/stream`;
            
            try {
                currentEventSource = new EventSource(sseUrl);
                
                currentEventSource.onopen = () => {
                    log(`‚úÖ SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–æ`, 'success');
                };
                
                currentEventSource.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        handleBatchUpdate(data);
                    } catch (e) {
                        log(`üì® ${event.data}`, 'info');
                    }
                };
                
                currentEventSource.addEventListener('progress', (event) => {
                    const data = JSON.parse(event.data);
                    handleBatchUpdate(data);
                });
                
                currentEventSource.addEventListener('complete', (event) => {
                    const data = JSON.parse(event.data);
                    log(`üéâ Batch –∑–∞–≤–µ—Ä—à—ë–Ω!`, 'success');
                    log(`üìä –£—Å–ø–µ—à–Ω–æ: ${data.successful || '?'}, –û—à–∏–±–æ–∫: ${data.failed || '?'}`, 'info');
                    currentEventSource.close();
                });
                
                currentEventSource.addEventListener('error', (event) => {
                    if (event.data) {
                        const data = JSON.parse(event.data);
                        log(`‚ùå –û—à–∏–±–∫–∞: ${data.message || data.error}`, 'error');
                    }
                });
                
                currentEventSource.onerror = (error) => {
                    log(`‚ö†Ô∏è SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...`, 'warning');
                    // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        if (currentEventSource.readyState === EventSource.CLOSED) {
                            pollBatchStatus(apiUrl, batchId);
                        }
                    }, 5000);
                };
                
            } catch (e) {
                log(`‚ùå SSE –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º polling`, 'warning');
                pollBatchStatus(apiUrl, batchId);
            }
        }
        
        function handleBatchUpdate(data) {
            const status = data.status || 'processing';
            const successCount = data.successCount || data.completed || data.current || 0;
            const failedCount = data.failedCount || 0;
            const total = data.total || data.totalVideos || 0;
            const progress = total > 0 ? Math.round(((successCount + failedCount) / total) * 100) : 0;
            
            // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            document.getElementById('uploadProgressFill').style.width = `${progress}%`;
            document.getElementById('uploadProgressFill').textContent = `${progress}%`;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
            if (status === 'failed') {
                document.getElementById('uploadProgressText').textContent = `‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞—Ç—á–∞`;
                document.getElementById('uploadProgressFill').style.background = 'linear-gradient(90deg, #ff4757, #ff6b81)';
                log(`‚ùå –ë–∞—Ç—á –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π`, 'error');
                log(`üìä –í—Å–µ–≥–æ –≤–∏–¥–µ–æ: ${total}, –£—Å–ø–µ—à–Ω–æ: ${successCount}, –û—à–∏–±–æ–∫: ${failedCount}`, 'info');
                if (data.error) {
                    log(`üí° –ü—Ä–∏—á–∏–Ω–∞: ${data.error}`, 'warning');
                }
                return;
            } else if (status === 'completed' || status === 'finished') {
                document.getElementById('uploadProgressText').textContent = `‚úÖ –ì–æ—Ç–æ–≤–æ! ${successCount}/${total} –≤–∏–¥–µ–æ`;
                document.getElementById('uploadProgressFill').style.background = 'linear-gradient(90deg, #00ff88, #00cc6a)';
                log(`üéâ –ë–∞—Ç—á –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!`, 'success');
                log(`üìä –£—Å–ø–µ—à–Ω–æ: ${successCount}, –û—à–∏–±–æ–∫: ${failedCount}`, 'info');
                return;
            } else if (status === 'processing' || status === 'pending') {
                document.getElementById('uploadProgressText').textContent = `‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞: ${successCount + failedCount}/${total} –≤–∏–¥–µ–æ`;
            } else {
                document.getElementById('uploadProgressText').textContent = `${successCount}/${total} –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ`;
            }
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ –≤–∏–¥–µ–æ
            if (data.videoId || data.filename) {
                const videoName = data.filename || data.videoId;
                const videoStatus = data.videoStatus || data.status;
                if (videoStatus === 'completed' || videoStatus === 'success') {
                    log(`‚úÖ ${videoName} - –∑–∞–≥—Ä—É–∂–µ–Ω–æ`, 'success');
                } else if (videoStatus === 'failed' || videoStatus === 'error') {
                    log(`‚ùå ${videoName} - –æ—à–∏–±–∫–∞: ${data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'}`, 'error');
                } else {
                    log(`‚è≥ ${videoName} - ${videoStatus}`, 'info');
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
            if (status === 'completed' || status === 'finished') {
                log(`üéâ –í—Å–µ –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã!`, 'success');
                document.getElementById('uploadProgressText').textContent = '–ì–æ—Ç–æ–≤–æ!';
                if (currentEventSource) {
                    currentEventSource.close();
                }
            }
        }
        
        // Fallback polling –µ—Å–ª–∏ SSE –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
        async function pollBatchStatus(apiUrl, batchId) {
            try {
                const response = await fetch(`${apiUrl}/api/batches/${batchId}`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    handleBatchUpdate(data.data);
                    
                    // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å polling –µ—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∏ –Ω–µ failed
                    const status = data.data.status;
                    if (status !== 'completed' && status !== 'finished' && status !== 'failed') {
                        setTimeout(() => pollBatchStatus(apiUrl, batchId), 3000);
                    }
                }
            } catch (e) {
                log(`‚ö†Ô∏è Polling error: ${e.message}`, 'warning');
                // –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => pollBatchStatus(apiUrl, batchId), 5000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –±–∞—Ç—á–µ–π
        async function loadBatches() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                const response = await fetch(`${tiktokApi}/api/batches`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    log(`üìã –ù–∞–π–¥–µ–Ω–æ –±–∞—Ç—á–µ–π: ${data.data.length}`, 'info');
                    data.data.slice(0, 5).forEach((batch, i) => {
                        log(`   ${i+1}. ${batch.id} - ${batch.status} (${batch.completed || 0}/${batch.total || 0})`, 'info');
                    });
                }
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // ==================== ACCOUNTS & RESOURCES ====================
        
        // Load accounts from backend
        async function loadAccounts() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç—ã...', 'info');
                const response = await fetch(`${tiktokApi}/api/managed-accounts`);
                const data = await response.json();
                
                // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { success: true, data: [...] }
                if (data.success && Array.isArray(data.data)) {
                    availableAccounts = data.data;
                } else if (Array.isArray(data.accounts)) {
                    availableAccounts = data.accounts;
                } else if (Array.isArray(data)) {
                    availableAccounts = data;
                } else {
                    availableAccounts = [];
                }
                
                renderAccountsList();
                calculateResources();
                
                log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${availableAccounts.length} –∞–∫–∫–∞—É–Ω—Ç–æ–≤`, 'success');
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ${e.message}`, 'error');
                document.getElementById('accountsList').innerHTML = '<p style="color: #ff4757;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É.</p>';
            }
        }
        
        // Render accounts list with checkboxes
        function renderAccountsList() {
            const container = document.getElementById('accountsList');
            
            if (availableAccounts.length === 0) {
                container.innerHTML = '<p style="color: #888;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤. <a href="#" onclick="showStep(7)" style="color: #00d4ff;">–ö—É–ø–∏—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ ‚Üí</a></p>';
                return;
            }
            
            // Group by proxy
            const byProxy = {};
            availableAccounts.forEach(acc => {
                const proxyId = acc.proxyId || 'no-proxy';
                if (!byProxy[proxyId]) byProxy[proxyId] = [];
                byProxy[proxyId].push(acc);
            });
            
            let html = '';
            Object.entries(byProxy).forEach(([proxyId, accounts]) => {
                const proxyStatus = proxyId === 'no-proxy' ? '‚ö†Ô∏è –ë–µ–∑ –ø—Ä–æ–∫—Å–∏' : `üåê –ü—Ä–æ–∫—Å–∏ #${proxyId.slice(-4)}`;
                const proxyColor = proxyId === 'no-proxy' ? '#ff4757' : '#00ff88';
                const accountsOnProxy = accounts.length;
                const proxyWarning = accountsOnProxy > 5 ? ' ‚ö†Ô∏è >5 –∞–∫–∫!' : '';
                
                html += `<div style="margin-bottom: 10px; padding: 10px; background: #0a0a1a; border-radius: 8px;">`;
                html += `<div style="color: ${proxyColor}; font-size: 0.85em; margin-bottom: 8px;">${proxyStatus} (${accountsOnProxy} –∞–∫–∫)${proxyWarning}</div>`;
                
                accounts.forEach(acc => {
                    const checked = selectedAccounts.includes(acc.id) ? 'checked' : '';
                    const statusIcon = acc.status === 'active' ? '‚úÖ' : '‚ö†Ô∏è';
                    const todayUploads = acc.todayUploads || 0;
                    const canUpload = todayUploads < 6;
                    const uploadStatus = canUpload ? `${todayUploads}/6` : '‚ùå –ª–∏–º–∏—Ç';
                    const disabled = !canUpload ? 'disabled' : '';
                    
                    html += `
                        <label style="display: flex; align-items: center; padding: 5px; cursor: ${canUpload ? 'pointer' : 'not-allowed'}; opacity: ${canUpload ? '1' : '0.5'};">
                            <input type="checkbox" ${checked} ${disabled} onchange="toggleAccount('${acc.id}')" style="margin-right: 10px;">
                            <span>${statusIcon} ${acc.username || acc.email}</span>
                            <span style="margin-left: auto; color: #888; font-size: 0.85em;">${uploadStatus}</span>
                        </label>
                    `;
                });
                
                html += `</div>`;
            });
            
            container.innerHTML = html;
        }
        
        // Toggle account selection
        function toggleAccount(accountId) {
            const idx = selectedAccounts.indexOf(accountId);
            if (idx > -1) {
                selectedAccounts.splice(idx, 1);
            } else {
                selectedAccounts.push(accountId);
            }
            calculateResources();
        }
        
        // Select all accounts
        function selectAllAccounts() {
            selectedAccounts = availableAccounts
                .filter(acc => (acc.todayUploads || 0) < 6)
                .map(acc => acc.id);
            renderAccountsList();
            calculateResources();
        }
        
        // Deselect all
        function deselectAllAccounts() {
            selectedAccounts = [];
            renderAccountsList();
            calculateResources();
        }
        
        // Calculate resources needed
        async function calculateResources() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            const zipSelect = document.getElementById('uploadZip');
            const selectedZip = zipSelect.value;
            
            // Get video count from ZIP name or fetch
            let videoCount = 0;
            if (selectedZip) {
                // Try to get from folder info
                try {
                    const folderName = selectedZip.replace('.zip', '').replace(/_\d{8}_\d{6}$/, '');
                    const response = await fetch(`${getApiUrl()}/cutter/folder-files/${folderName}`);
                    const data = await response.json();
                    videoCount = data.files?.length || 0;
                } catch (e) {
                    // Estimate from filename
                    videoCount = 5; // default estimate
                }
            }
            
            document.getElementById('calcVideos').textContent = videoCount || '-';
            
            // Calculate accounts needed (max 6 videos per account per day)
            const accountsNeeded = Math.ceil(videoCount / 6);
            document.getElementById('calcAccountsNeeded').textContent = accountsNeeded || '-';
            
            // Available accounts (that can still upload today)
            const availableForUpload = availableAccounts.filter(acc => (acc.todayUploads || 0) < 6);
            document.getElementById('calcAccountsAvailable').textContent = availableForUpload.length;
            
            // Calculate proxies needed (max 5 accounts per proxy)
            const proxiesNeeded = Math.ceil(accountsNeeded / 5);
            document.getElementById('calcProxiesNeeded').textContent = proxiesNeeded || '-';
            
            // Check if we have enough resources
            const statusDiv = document.getElementById('resourceStatus');
            const warningDiv = document.getElementById('resourceWarning');
            const btnBuyAccounts = document.getElementById('btnBuyAccounts');
            const btnBuyProxies = document.getElementById('btnBuyProxies');
            
            const hasEnoughAccounts = availableForUpload.length >= accountsNeeded;
            const uniqueProxies = new Set(availableAccounts.map(a => a.proxyId).filter(p => p)).size;
            const hasEnoughProxies = uniqueProxies >= proxiesNeeded;
            
            if (hasEnoughAccounts && hasEnoughProxies && videoCount > 0) {
                statusDiv.style.display = 'block';
                statusDiv.style.borderColor = '#00ff88';
                statusDiv.style.background = 'rgba(0,255,136,0.1)';
                document.getElementById('resourceStatusText').innerHTML = '‚úÖ –†–µ—Å—É—Ä—Å–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∑–∞–ª–∏–≤–∫–∏!';
                warningDiv.style.display = 'none';
            } else if (videoCount > 0) {
                statusDiv.style.display = 'none';
                warningDiv.style.display = 'block';
                
                let warnings = [];
                if (!hasEnoughAccounts) {
                    warnings.push(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${accountsNeeded - availableForUpload.length} –∞–∫–∫–∞—É–Ω—Ç–æ–≤`);
                    btnBuyAccounts.style.display = 'inline-block';
                } else {
                    btnBuyAccounts.style.display = 'none';
                }
                
                if (!hasEnoughProxies) {
                    warnings.push(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${proxiesNeeded - uniqueProxies} –ø—Ä–æ–∫—Å–∏`);
                    btnBuyProxies.style.display = 'inline-block';
                } else {
                    btnBuyProxies.style.display = 'none';
                }
                
                document.getElementById('resourceWarningText').innerHTML = '‚ö†Ô∏è ' + warnings.join(', ');
            } else {
                statusDiv.style.display = 'none';
                warningDiv.style.display = 'none';
            }
        }
        
        // ==================== SHOP FUNCTIONS ====================
        
        function showShopTab(tab) {
            document.querySelectorAll('#content7 .tabs .tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('shopAccounts').style.display = tab === 'accounts' ? 'block' : 'none';
            document.getElementById('shopProxies').style.display = tab === 'proxies' ? 'block' : 'none';
        }
        
        // DarkShop functions
        async function checkDarkshopBalance() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                const response = await fetch(`${tiktokApi}/api/darkshop/status`);
                const data = await response.json();
                document.getElementById('darkshopBalance').textContent = data.balance || data.data?.balance || '-';
                log(`üí∞ DarkShop –±–∞–ª–∞–Ω—Å: ${data.balance || data.data?.balance}‚ÇΩ`, 'success');
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ DarkShop: ${e.message}`, 'error');
            }
        }
        
        async function loadDarkshopProducts() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã DarkShop...', 'info');
                const response = await fetch(`${tiktokApi}/api/darkshop/products`);
                const data = await response.json();
                
                const select = document.getElementById('darkshopProduct');
                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä --</option>';
                
                const products = data.products || data.data || [];
                products.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = `${p.name} - ${p.price}‚ÇΩ (–≤ –Ω–∞–ª–∏—á–∏–∏: ${p.count || p.quantity || '?'})`;
                    select.appendChild(option);
                });
                
                log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${products.length} —Ç–æ–≤–∞—Ä–æ–≤`, 'success');
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤: ${e.message}`, 'error');
            }
        }
        
        async function buyDarkshopAccounts() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            const productId = document.getElementById('darkshopProduct').value;
            const quantity = document.getElementById('darkshopQuantity').value;
            
            if (!productId) {
                log('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä', 'warning');
                return;
            }
            
            try {
                log(`üõí –ü–æ–∫—É–ø–∞–µ–º ${quantity} –∞–∫–∫–∞—É–Ω—Ç–æ–≤...`, 'info');
                const response = await fetch(`${tiktokApi}/api/darkshop/purchase`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ productId, quantity: parseInt(quantity) })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`‚úÖ –ö—É–ø–ª–µ–Ω–æ ${quantity} –∞–∫–∫–∞—É–Ω—Ç–æ–≤!`, 'success');
                    loadAccounts(); // Refresh accounts
                    checkDarkshopBalance(); // Update balance
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏: ${data.error || data.message}`, 'error');
                }
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // PX6 functions
        async function checkPx6Balance() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                const response = await fetch(`${tiktokApi}/api/px6/status`);
                const data = await response.json();
                document.getElementById('px6Balance').textContent = data.balance || data.data?.balance || '-';
                log(`üí∞ PX6 –±–∞–ª–∞–Ω—Å: ${data.balance || data.data?.balance}‚ÇΩ`, 'success');
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ PX6: ${e.message}`, 'error');
            }
        }
        
        async function buyPx6Proxies() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            const country = document.getElementById('px6Country').value;
            const quantity = document.getElementById('px6Quantity').value;
            const period = document.getElementById('px6Period').value;
            
            try {
                log(`üõí –ü–æ–∫—É–ø–∞–µ–º ${quantity} –ø—Ä–æ–∫—Å–∏ (${country}, ${period} –¥–Ω–µ–π)...`, 'info');
                const response = await fetch(`${tiktokApi}/api/px6/buy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ country, quantity: parseInt(quantity), period: parseInt(period) })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`‚úÖ –ö—É–ø–ª–µ–Ω–æ ${quantity} –ø—Ä–æ–∫—Å–∏!`, 'success');
                    checkPx6Balance();
                    loadPx6Proxies();
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏: ${data.error || data.message}`, 'error');
                }
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }
        
        // Load current proxies list
        async function loadPx6Proxies() {
            const tiktokApi = document.getElementById('tiktokApiUrl').value;
            try {
                const response = await fetch(`${tiktokApi}/api/proxies`);
                const data = await response.json();
                
                const container = document.getElementById('px6ProxiesList');
                const proxies = data.data || data.proxies || data || [];
                
                if (Array.isArray(proxies) && proxies.length > 0) {
                    container.innerHTML = proxies.map(p => `
                        <div style="padding: 8px; background: #16213e; border-radius: 6px; margin-bottom: 5px; font-size: 0.9em;">
                            <span style="color: ${p.status === 'working' ? '#00ff88' : '#ffa502'};">‚óè</span>
                            ${p.host}:${p.port} 
                            <span style="color: #888;">(${p.country || 'US'})</span>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="color: #888;">–ù–µ—Ç –ø—Ä–æ–∫—Å–∏</p>';
                }
            } catch (e) {
                // Ignore errors
            }
        }
        
        // Auto-load data when entering steps
        const originalShowStep = showStep;
        showStep = function(step) {
            originalShowStep(step);
            if (step === 5) {
                loadAccounts();
            }
            if (step === 7) {
                checkDarkshopBalance();
                checkPx6Balance();
                loadDarkshopProducts();
                loadPx6Proxies();
            }
        };
        
        // Initial log
        log('–£–∫–∞–∂–∏—Ç–µ URL API –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã', 'info');
        
    </script>
    

</body>
</html>
